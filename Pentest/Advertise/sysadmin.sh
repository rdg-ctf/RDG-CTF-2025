#!/bin/bash

show_header() {
    echo -e "\n\033[1;34m===== SYSTEM MONITOR =====\033[0m"
}

show_menu() {
    echo "

1. General system information

2. CPU information

3. Memory usage

4. List kernel modules (vulnerable function)

5. Exit"
}

cpu_info() {
    echo -e "\n\033[1;32m* CPU Information *\033[0m"
    lscpu | grep -E 'Model|Architecture|CPU(s)|CPU MHz'
}

memory_usage() {
    echo -e "\n\033[1;32m* Memory Usage *\033[0m"
    free -h | awk '/Mem/{printf "Total: %s, Used: %s, Free: %s\n", $2, $3, $4}'
}

system_info() {
    echo -e "\n\033[1;32m* General Information *\033[0m"
    echo "Hostname: $(hostname)"
    echo "Uptime: $(uptime -p)"
    echo "Kernel Version: $(uname -r)"
}

kernel_modules() {
    read -p "Enter arguments for filtering (or press Enter to skip): " user_args
    echo -e "\n\033[1;32m* Kernel Modules (filtering: ${user_args:-no filters}) *\033[0m"

    eval ls $user_args /sys/module 2>/dev/null || echo " No results"
}

main() {
    while true; do
        show_header
        show_menu
        read -p "Choose an action: " choice

        case $choice in
            1) system_info ;;
            2) cpu_info ;;
            3) memory_usage ;;
            4) kernel_modules ;;
            5) exit 0 ;;
            *) echo "Invalid choice!" ;;
        esac

        read -p "Press Enter to continue..."
    done
}

main